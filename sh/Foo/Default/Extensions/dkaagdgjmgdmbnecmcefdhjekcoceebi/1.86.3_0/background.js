!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){chrome.tabs.sendMessage(a,{type:o.MESSAGE__CONTENT_TOGGLE_PANEL})}function e(a,b){n.trackRun(),chrome.tabs.insertCSS(a,{file:"styles/style.css"}),chrome.tabs.executeScript(a,{code:"var extensionSettings="+JSON.stringify(j())+";"},function(){chrome.tabs.executeScript(a,{file:"content.js"},function(){"function"==typeof b?b():d(a)})})}function f(a){function b(b){chrome.browserAction.setPopup({tabId:a.id,popup:b})}function c(b){chrome.browserAction.setIcon({path:chrome.extension.getURL(b),tabId:a.id})}var d="images/icons/icon.png";a.url.match(/^chrome:/)||a.url.match(/^https:\/\/chrome.google.com\/webstore/)||(a.url.match(/file:\//)?chrome.extension.isAllowedFileSchemeAccess(function(a){a?(c(d),b("")):b("popups/file-scheme-access-not-allowed.html")}):(c(d),b("")))}function g(a){chrome.tabs.query({status:"complete"},function(b){for(var c=0;c<b.length;c++)chrome.tabs.sendMessage(b[c].id,a)})}function h(a,b){b(a instanceof m.PPFile?{status:"OK",fileName:a.Name,fileType:a.MimeType,arrayBuffer:l.bufferToString(a.ArrayBuffer)}:a?{status:"FAIL",message:a.message,showToUser:a.showToUser}:{status:"FAIL"})}function i(){for(var a in q)if(q.hasOwnProperty(a)){var b=localStorage["store.settings."+a];void 0===b&&(localStorage["store.settings."+a]=q[a])}void 0!==localStorage["store.settings.enableStatistics"]&&(localStorage["store.settings.sendStatistics"]=localStorage["store.settings.enableStatistics"],localStorage.removeItem("store.settings.enableStatistics")),void 0!==localStorage["store.settings.disableSupportedByAd"]&&(localStorage["store.settings.disableAds"]=localStorage["store.settings.disableSupportedByAd"],localStorage.removeItem("store.settings.disableSupportedByAd"))}function j(){var a={};for(var b in q)q.hasOwnProperty(b)&&(a[b]=k(b));return a.defaultLocale=chrome.runtime.getManifest().default_locale,a.version=chrome.runtime.getManifest().version,a}function k(a){var b=localStorage["store.settings."+a];if(void 0===b&&(b=q[a]),"customCssCode"===a)return b.replace(/^"/,"").replace(/"$/,"");if(b!==!1&&b!==!0&&"false"!==b&&"true"!==b)throw new Error("Caution! We support only Boolean settings for now!!!");return b===!0||"true"===b}var l=a("../../utils/file-utils"),m=a("./filemanager"),n=a("../../utils/background/analytics.chrome"),o=a("../../constants/constants-chrome");document.addEventListener("DOMContentLoaded",function(a){i(),j().sendStatistics&&n.init({googleAnalyticsId:"UA-26666773-2",extVersion:chrome.runtime.getManifest().version}),chrome.tabs.getAllInWindow(null,function(a){for(var b=0;b<a.length;b++)f(a[b])})});var p=[];chrome.tabs.onUpdated.addListener(function(a,b,c){"loading"==b.status&&f(c)}),chrome.browserAction.onClicked.addListener(function(a){var b=p[a.id];b?("open"==b?p[a.id]="closed":"closed"==b&&(p[a.id]="open"),d(a.id)):(p[a.id]="open",e(a.id))}),chrome.tabs.onUpdated.addListener(function(a,b){if(!k("rememberPanelOpenClosedState"))return void delete p[a];var c=p[a];c&&"complete"===b.status&&("open"===c?e(a):"closed"===c&&e(a,function(){}))}),chrome.tabs.onRemoved.addListener(function(a){delete p[a]}),chrome.runtime.onMessage.addListener(function(a,b,c){if(a.type===o.MESSAGE_GET_TAB_ID)c({tabId:b.tab.id});else if(a.type===o.MESSAGE_EXECUTE_SCRIPT)chrome.tabs.executeScript(b.tab.id,a.options,function(a){c(a)});else if(a.type===o.MESSAGE_OPEN_SETTINGS_PAGE){var d=chrome.extension.getURL("fancy-settings/source/index.html");chrome.tabs.query({url:d},function(a){a.length?chrome.tabs.update(a[0].id,{active:!0}):chrome.tabs.create({url:d}),c()})}else if(a.type===o.MESSAGE_TRACK_EVENT){var e={eventCategory:a.eventCategory,eventAction:a.eventAction,eventValue:a.eventValue,eventLabel:a.eventLabel};n.trackEvent(e),c(!0)}else a.type===o.MESSAGE_GET_FILE||a.type===o.MESSAGE_ADD_FILE||a.type===o.MESSAGE_DELETE_FILE?m.PPFileManager.Init(function(b){a.type===o.MESSAGE_GET_FILE?!function(){var b=a.fileName;m.PPFileManager.GetFile(b,function(a){h(a,c)})}():a.type===o.MESSAGE_ADD_FILE?!function(){var b=new m.PPFile;b.ArrayBuffer=l.stringToBuffer(a.fileData),b.Name=a.fileName,b.MimeType=a.fileType,m.PPFileManager.SaveFile(b,function(a){h(a,c)})}():a.type===o.MESSAGE_DELETE_FILE?!function(){var b=a.fileName;m.PPFileManager.DeleteFiles(b,function(){c({status:"OK"})})}():h(b,c)}):a.type===o.MESSAGE_GET_GLOBAL_STORAGE_ELEMENT?c({value:localStorage[a.key]}):a.type===o.MESSAGE_SET_GLOBAL_STORAGE_ELEMENT&&("perfectpixel-notification"===a.key?(!localStorage[a.key]||parseInt(localStorage[a.key])<a.value)&&(localStorage[a.key]=a.value):localStorage[a.key]=a.value,g({type:o.MESSAGE__CONTENT_GLOBAL_STORAGE_UPDATED,key:a.key}),c());return!0});var q={debugMode:!1,customCssCode:"",rememberPanelOpenClosedState:!1,enableDeleteLayerConfirmationMessage:!1,allowPositionChangeWhenLocked:!0,enableHotkeys:!0,enableMousewheelOpacity:!0,NewLayerMoveToScrollPosition:!0,sendStatistics:!0,disableAds:!1}},{"../../constants/constants-chrome":3,"../../utils/background/analytics.chrome":4,"../../utils/file-utils":5,"./filemanager":2}],2:[function(a,b,c){"use strict";var d=function(){this.ArrayBuffer=null,this.Name=null,this.MimeType=null,this.Date=null,this.ToBlob=function(){var a=new DataView(this.ArrayBuffer);return new Blob([a],{type:this.MimeType})}},e=function(){function a(a){var c=b(a);console.log("PPFileManager error: "+c)}function b(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b="Unknown Error"}return b}function c(){return{showToUser:!0,message:"ERROR: Cannot open filesystem.\r\nPlease use Storage compatibility mode in options.\r\n\r\nPossible reason: user's profile directory path contains non-latin characters (http://code.google.com/p/chromium/issues/detail?id=94314)"}}var e=null;return{Init:function(b){e?b():(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.PERSISTENT,524288e3,function(a){console.log("PP Opened file system: "+a.name),e=a,b()},function(d){a(d),b(c())}))},GetFile:function(b,f){return e?void e.root.getFile(b,{},function(b){b.file(function(b){var c=new FileReader;c.onerror=function(b){a(b),f()},c.onloadend=function(a){var c=new d;c.ArrayBuffer=this.result,c.Name=b.name,c.MimeType=b.type,c.Date=b.lastModifiedDate,f(c)},c.readAsArrayBuffer(b)},function(b){a(b),f()})},function(b){a(b),f()}):(console.log("PP Filesystem is not initialized"),void f(c()))},SaveFile:function(b,d){if(!e)return console.log("PP Filesystem is not initialized"),void d(c());var f=Math.floor(1e14*Math.random())+"_"+b.Name,g=b.ToBlob();e.root.getFile(f,{create:!0},function(c){console.log("PP file created"),c.createWriter(function(a){a.onwriteend=function(a){console.log("PP data written"),b.Name=f,b.Date=c.lastModifiedDate,d(b)},a.write(g)},function(b){a(b),d()})},function(b){a(b),d()})},DeleteFile:function(b,d){return e?void e.root.getFile(b,{create:!1},function(b){b.remove(function(){console.log("PP File removed"),d()},function(b){a(b),d()})},function(b){a(b),d()}):(console.log("PP Filesystem is not initialized"),void d(c()))},DeleteFiles:function(a,b){var c=[],d=100500;Array.isArray(a)||(a=[a]);for(var e=0;e<a.length;e++){var f=e;this.DeleteFile(a[f],function(){c.push(d),c.length==a.length&&b()})}}}}();b.exports={PPFile:d,PPFileManager:e}},{}],3:[function(a,b,c){"use strict";var d=a("keymirror");b.exports=d({MESSAGE__CONTENT_TOGGLE_PANEL:null,MESSAGE__CONTENT_GLOBAL_STORAGE_UPDATED:null,MESSAGE_GET_TAB_ID:null,MESSAGE_EXECUTE_SCRIPT:null,MESSAGE_OPEN_SETTINGS_PAGE:null,MESSAGE_TRACK_EVENT:null,MESSAGE_GET_FILE:null,MESSAGE_ADD_FILE:null,MESSAGE_DELETE_FILE:null,MESSAGE_GET_GLOBAL_STORAGE_ELEMENT:null,MESSAGE_SET_GLOBAL_STORAGE_ELEMENT:null})},{keymirror:6}],4:[function(a,b,c){"use strict";var d=null;b.exports={init:function(a){var b="https://www.google-analytics.com/analytics.js";!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script",b,"ga"),d=a.extVersion,ga("create",a.googleAnalyticsId,"auto"),ga("set","checkProtocolTask",function(a){a.set("location","http://perfectpixelfirefox.com")})},trackRun:function(){window.ga&&ga("send","pageview",{dimension1:d})},trackEvent:function(a){var b={eventCategory:String(a.eventCategory),eventAction:String(a.eventAction)};"undefined"!=typeof a.eventValue&&null!==a.eventValue&&(b.eventValue=Number(a.eventValue)),"undefined"!=typeof a.eventLabel&&null!==a.eventLabel&&(b.eventLabel=String(a.eventLabel)),window.ga&&ga("send","event",b)}}},{}],5:[function(a,b,c){"use strict";b.exports={bufferToString:function(a){var b=new Uint8Array(a);return Array.prototype.join.call(b,",")},stringToBuffer:function(a){var b=a.split(","),c=new Uint8Array(b);return c.buffer},createBlobUrl:function(a){var b;return window.createObjectURL?b=window.createObjectURL(a):window.createBlobURL?b=window.createBlobURL(a):window.URL&&window.URL.createObjectURL?b=window.URL.createObjectURL(a):window.webkitURL&&window.webkitURL.createObjectURL&&(b=window.webkitURL.createObjectURL(a)),b},revokeBlobUrl:function(a){window.revokeObjectURL?window.revokeObjectURL(a):window.revokeBlobURL?window.revokeBlobURL(a):window.URL&&window.URL.revokeObjectURL?window.URL.revokeObjectURL(a):window.webkitURL&&window.webkitURL.revokeObjectURL&&window.webkitURL.revokeObjectURL(a)}}},{}],6:[function(a,b,c){"use strict";!function(){var a=function(a){var b,c={};if(!(a instanceof Object)||Array.isArray(a))throw new Error("keyMirror(...): Argument must be an object.");for(b in a)a.hasOwnProperty(b)&&(c[b]=b);return c};"undefined"!=typeof b&&b.exports?b.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.keyMirror=a}()},{}]},{},[1]);